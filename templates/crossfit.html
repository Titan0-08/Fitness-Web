<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrossFit</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Updated to use a background image */
            background: url('https://i.pinimg.com/1200x/75/b4/ca/75b4ca2981f036e408e3568a0f7e9883.jpg') no-repeat center center fixed;
            background-size: cover;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            width: 100%;
        }
        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            user-select: none;
        }
        .category-tag.pull { background-color: #f59e0b; }
        .category-tag.push { background-color: #ef4444; }
        .category-tag.legs { background-color: #22c55e; }
        .category-tag.core { background-color: #3b82f6; }
        .category-tag.cardio { background-color: #a855f7; }
        .difficulty-tag.beginner { background-color: #10b981; }
        .difficulty-tag.intermediate { background-color: #eab308; }
        .difficulty-tag.advanced { background-color: #ef4444; }

        .exercise-card {
            display: flex;
            flex-direction: column;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            background-color: rgba(17, 24, 39, 0.8); /* Semi-transparent for cards */
            backdrop-filter: blur(5px); /* Add a subtle blur effect */
            transition: transform 0.2s ease-in-out;
            cursor: pointer;
        }
        .exercise-card:hover {
            transform: translateY(-5px);
        }
        .exercise-image-container {
            width: 100%;
            height: 180px;
            overflow: hidden;
            position: relative;
        }
        .exercise-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .exercise-image-container .overlay-tags {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background-color: rgba(17, 24, 39, 0.9); /* Semi-transparent dark modal background */
            backdrop-filter: blur(10px);
            color: #e5e7eb; /* Light text for contrast */
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            color: #e5e7eb;
        }
        .modal-video-placeholder {
            width: 100%;
            height: 250px;
            background-color: #000000; /* Pure black for video placeholder */
            border-radius: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e5e7eb;
            font-weight: 500;
            font-size: 1.25rem;
        }
    </style>
</head>
<body class="text-gray-200 p-8">

    <div class="container mx-auto">
      <a href="{{ url_for('menu') }}" 
        class="inline-block mb-6 px-4 py-2 bg-gray-700 text-white rounded-lg shadow hover:bg-gray-600 transition">
        ‚Üê Back to Menu
      </a>
        <header class="text-center mb-12">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">CrossFit Exercise Library</h1>
            <p class="text-sm sm:text-base text-gray-400 mt-2">Discover popular CrossFit movements with form cues and demonstrations</p>
        </header>

        <!-- Filters Section -->
        <div class="bg-gray-900 p-6 rounded-2xl shadow-md mb-8 bg-opacity-80 backdrop-filter backdrop-blur-sm">
            <h2 class="text-lg font-semibold text-gray-200 mb-4">Filters</h2>
            
            <!-- Search Bar -->
            <div class="mb-6">
                <input id="search-input" type="text" placeholder="Search exercises..." class="w-full p-3 pl-4 rounded-full border border-gray-700 bg-gray-800 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all bg-opacity-70">
            </div>

            <!-- Category Filters -->
            <div class="mb-6">
                <h3 class="font-medium text-gray-400 mb-2">Category</h3>
                <div id="category-filters" class="flex flex-wrap gap-2">
                    <span data-category="pull" class="category-tag tag text-white bg-orange-500 hover:bg-orange-600 cursor-pointer">Pull</span>
                    <span data-category="push" class="category-tag tag text-white bg-red-500 hover:bg-red-600 cursor-pointer">Push</span>
                    <span data-category="legs" class="category-tag tag text-white bg-green-500 hover:bg-green-600 cursor-pointer">Legs</span>
                    <span data-category="core" class="category-tag tag text-white bg-blue-500 hover:bg-blue-600 cursor-pointer">Core</span>
                    <span data-category="cardio" class="category-tag tag text-white bg-purple-500 hover:bg-purple-600 cursor-pointer">Cardio</span>
                </div>
            </div>

            <!-- Difficulty Filters -->
            <div>
                <h3 class="font-medium text-gray-400 mb-2">Difficulty</h3>
                <div id="difficulty-filters" class="flex flex-wrap gap-2">
                    <span data-difficulty="beginner" class="difficulty-tag tag text-white bg-teal-500 hover:bg-teal-600 cursor-pointer">Beginner</span>
                    <span data-difficulty="intermediate" class="difficulty-tag tag text-white bg-yellow-500 hover:bg-yellow-600 cursor-pointer">Intermediate</span>
                    <span data-difficulty="advanced" class="difficulty-tag tag text-white bg-red-500 hover:bg-red-600 cursor-pointer">Advanced</span>
                </div>
            </div>
        </div>

        <!-- Exercise Counts -->
        <div id="exercise-counts" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mb-8">
            <!-- Counts will be dynamically populated here -->
            <div class="bg-gray-900 p-4 rounded-2xl shadow text-center bg-opacity-80 backdrop-filter backdrop-blur-sm">
                <div id="count-pull" class="text-2xl font-bold text-orange-500">0</div>
                <div class="text-gray-400 text-sm">Pull</div>
            </div>
            <div class="bg-gray-900 p-4 rounded-2xl shadow text-center bg-opacity-80 backdrop-filter backdrop-blur-sm">
                <div id="count-push" class="text-2xl font-bold text-red-500">0</div>
                <div class="text-gray-400 text-sm">Push</div>
            </div>
            <div class="bg-gray-900 p-4 rounded-2xl shadow text-center bg-opacity-80 backdrop-filter backdrop-blur-sm">
                <div id="count-legs" class="text-2xl font-bold text-green-500">0</div>
                <div class="text-gray-400 text-sm">Legs</div>
            </div>
            <div class="bg-gray-900 p-4 rounded-2xl shadow text-center bg-opacity-80 backdrop-filter backdrop-blur-sm">
                <div id="count-core" class="text-2xl font-bold text-blue-500">0</div>
                <div class="text-gray-400 text-sm">Core</div>
            </div>
            <div class="bg-gray-900 p-4 rounded-2xl shadow text-center bg-opacity-80 backdrop-filter backdrop-blur-sm">
                <div id="count-cardio" class="text-2xl font-bold text-purple-500">0</div>
                <div class="text-gray-400 text-sm">Cardio</div>
            </div>
        </div>

        <!-- Exercise Grid -->
        <div id="exercises-grid-container" class="bg-gray-900 p-6 rounded-2xl shadow-md bg-opacity-80 backdrop-filter backdrop-blur-sm">
            <h2 class="text-lg font-semibold text-gray-200 mb-4">Showing <span id="exercise-count-text">0</span> exercises</h2>
            <div id="exercises-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Exercise cards will be dynamically populated here -->
            </div>
        </div>
    </div>

    <!-- The Modal -->
    <div id="exercise-modal" class="modal hidden">
        <div class="modal-content w-full sm:w-1/2 lg:w-2/5">
            <span class="close-button">&times;</span>
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                <h3 id="modal-name" class="text-2xl font-bold text-white"></h3>
                <div id="modal-tags" class="flex gap-2 mt-2 sm:mt-0"></div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <!-- Left side: Video, Equipment, Sets & Reps -->
                <div class="space-y-4">
                    <div id="modal-video-container" class="modal-video-placeholder">Video Placeholder</div>
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-1">Equipment</h4>
                        <ul id="modal-equipment" class="list-disc list-inside text-sm text-gray-400"></ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-1">Sets & Reps</h4>
                        <ul id="modal-sets-reps" class="list-disc list-inside text-sm text-gray-400"></ul>
                    </div>
                </div>

                <!-- Right side: Description, Target Muscles, Instructions -->
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-1">Description</h4>
                        <p id="modal-description" class="text-sm text-gray-400"></p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-1">Target Muscles</h4>
                        <div id="modal-target-muscles" class="flex flex-wrap gap-2 text-sm"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-300 mb-1">Instructions</h4>
                        <ol id="modal-instructions" class="list-decimal list-inside text-sm text-gray-400"></ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data for all exercises
        const EXERCISES = [
            {
                name: "Burpees",
                description: "A full-body exercise that combines a push-up with a vertical jump, excellent for cardiovascular conditioning.",
                category: "cardio",
                difficulty: "intermediate",
                tags: ["Cardio", "Push", "Bodyweight", "Full Body"],
                image: "https://placehold.co/400x200/ef4444/ffffff?text=Burpees",
                video: "https://www.youtube.com/embed/dZgkf7-qH9E?controls=0",
                equipment: ["None"],
                setsReps: ["3 sets of 10-15 reps"],
                targetMuscles: ["Chest", "Shoulders", "Quads", "Hamstrings", "Glutes", "Core"],
                instructions: [
                    "Start in a standing position",
                    "Drop into a squat with hands on the floor",
                    "Kick your feet back to a plank position",
                    "Perform a push-up (optional)",
                    "Jump your feet back to the squat position",
                    "Explosively jump up with your hands overhead"
                ]
            },
            {
                name: "Box Jumps",
                description: "A plyometric exercise that builds explosive power and strengthens the legs and glutes.",
                category: "legs",
                difficulty: "intermediate",
                tags: ["Legs", "Cardio", "Plyometrics", "Box"],
                image: "https://placehold.co/400x200/22c55e/ffffff?text=Box+Jumps",
                video: "https://www.youtube.com/embed/J7gY-n-zF1A?controls=0",
                equipment: ["Plyo Box"],
                setsReps: ["3 sets of 8-12 reps"],
                targetMuscles: ["Quads", "Hamstrings", "Glutes", "Calves"],
                instructions: [
                    "Stand facing a box with feet shoulder-width apart",
                    "Bend at the hips and knees to generate power",
                    "Swing your arms and jump onto the box",
                    "Land softly with both feet on the box",
                    "Stand up fully on the box before stepping or jumping back down"
                ]
            },
            {
                name: "Toes-to-Bar",
                description: "An advanced core and upper body exercise that requires significant grip strength and abdominal control.",
                category: "core",
                difficulty: "advanced",
                tags: ["Core", "Pull", "Gymnastics", "Rig"],
                image: "https://placehold.co/400x200/3b82f6/ffffff?text=Toes-to-Bar",
                video: "https://www.youtube.com/embed/j4F2o1sXjV0?controls=0",
                equipment: ["Pull-up Bar"],
                setsReps: ["3-5 sets of 5-10 reps"],
                targetMuscles: ["Abs", "Obliques", "Lats", "Forearms"],
                instructions: [
                    "Hang from a pull-up bar with an overhand grip",
                    "Engage your core and maintain a hollow body position",
                    "Swing your legs forward and upward",
                    "Touch your toes to the bar",
                    "Lower your legs back to the starting position with control"
                ]
            },
            {
                name: "Wall Balls",
                description: "A full-body functional movement that combines a squat and a push press, often used in high-intensity workouts.",
                category: "legs",
                difficulty: "intermediate",
                tags: ["Legs", "Push", "Cardio", "Medicine Ball"],
                image: "https://placehold.co/400x200/a855f7/ffffff?text=Wall+Balls",
                video: "https://www.youtube.com/embed/14QzQWqN4u8?controls=0",
                equipment: ["Medicine Ball"],
                setsReps: ["As many as possible in 1-2 minutes"],
                targetMuscles: ["Quads", "Glutes", "Shoulders", "Triceps", "Core"],
                instructions: [
                    "Hold a medicine ball at chest height facing a wall",
                    "Stand a comfortable distance from the wall",
                    "Perform a full squat",
                    "As you stand up, throw the ball to a target on the wall",
                    "Catch the ball on the rebound and immediately transition into the next squat"
                ]
            },
            {
                name: "Kettlebell Swings",
                description: "A dynamic, full-body exercise that builds strength and power in the glutes, hamstrings, and core.",
                category: "cardio",
                difficulty: "intermediate",
                tags: ["Cardio", "Intermediate", "Kettlebells", "Glutes"],
                image: "https://placehold.co/400x200/1e293b/ffffff?text=Kettlebell+Swings",
                video: "https://www.youtube.com/embed/5F_u94HTMlo?controls=0",
                equipment: ["Kettlebell"],
                setsReps: ["3-4 sets of 15-20 reps"],
                targetMuscles: ["Glutes", "Hamstrings", "Core"],
                instructions: [
                    "Stand with feet shoulder-width apart",
                    "Hinge at the hips, keeping your back straight",
                    "Swing the kettlebell between your legs",
                    "Thrust your hips forward to swing the bell up to chest height",
                    "Control the descent back down"
                ]
            },
            {
                name: "Double Unders",
                description: "A challenging jump rope variation where the rope passes under your feet twice per jump, great for agility and cardio.",
                category: "cardio",
                difficulty: "advanced",
                tags: ["Cardio", "Agility", "Jump Rope"],
                image: "https://placehold.co/400x200/525252/ffffff?text=Double+Unders",
                video: "https://www.youtube.com/embed/U9sO6g4qL8Q?controls=0",
                equipment: ["Jump Rope"],
                setsReps: ["Practice for 5-10 minutes"],
                targetMuscles: ["Calves", "Quads", "Forearms"],
                instructions: [
                    "Hold the jump rope with your elbows close to your body",
                    "Jump a little higher than a single jump",
                    "Spin the rope twice as fast with a flick of the wrist",
                    "Keep your core tight and maintain a steady rhythm"
                ]
            },
            {
                name: "Ring Dips",
                description: "An advanced variation of the dip that builds immense stability and strength in the chest, shoulders, and triceps.",
                category: "push",
                difficulty: "advanced",
                tags: ["Push", "Advanced", "Gymnastics", "Rings"],
                image: "https://placehold.co/400x200/f59e0b/ffffff?text=Ring+Dips",
                video: "https://www.youtube.com/embed/5U2z03QjP4I?controls=0",
                equipment: ["Gymnastic Rings"],
                setsReps: ["3-5 sets of 3-8 reps"],
                targetMuscles: ["Triceps", "Chest", "Shoulders"],
                instructions: [
                    "Hold the rings and support your body above them",
                    "Rotate your hands to keep your palms facing in",
                    "Lower your body by bending your elbows",
                    "Push back up to the starting position",
                    "Maintain stability throughout the movement"
                ]
            },
            {
                name: "Air Squat",
                description: "A fundamental bodyweight squat to build lower body strength and perfect movement mechanics.",
                category: "legs",
                difficulty: "beginner",
                tags: ["Legs", "Bodyweight", "Beginner", "Squat"],
                image: "https://placehold.co/400x200/a8a29e/ffffff?text=Air+Squat",
                video: "https://www.youtube.com/embed/C_VtbuWn_70?controls=0",
                equipment: ["None"],
                setsReps: ["3 sets of 15-20 reps"],
                targetMuscles: ["Quads", "Glutes", "Hamstrings"],
                instructions: [
                    "Stand with feet shoulder-width apart",
                    "Keep your chest up and core tight",
                    "Lower your hips as if sitting in a chair",
                    "Maintain a natural arch in your lower back",
                    "Drive through your feet to stand back up"
                ]
            },
            {
                name: "Handstand Push-ups",
                description: "An advanced gymnastic movement that builds incredible shoulder and core strength.",
                category: "push",
                difficulty: "advanced",
                tags: ["Push", "Advanced", "Gymnastics", "Bodyweight"],
                image: "https://placehold.co/400x200/10b981/ffffff?text=Handstand+Push-ups",
                video: "https://www.youtube.com/embed/j98zV_v41a4?controls=0",
                equipment: ["Wall"],
                setsReps: ["3-5 sets of 3-5 reps"],
                targetMuscles: ["Shoulders", "Triceps", "Core"],
                instructions: [
                    "Kick up into a handstand against a wall",
                    "Bend your elbows to lower your head towards the floor",
                    "Keep your core tight and body in a straight line",
                    "Press back up to the starting handstand position"
                ]
            },
            {
                name: "Plank",
                description: "The plank is a popular isometric core exercise that works the entire body, especially the abdominal muscles.",
                category: "core",
                difficulty: "beginner",
                tags: ["Core", "Beginner", "Bodyweight"],
                image: "https://placehold.co/400x200/ef4444/ffffff?text=Plank",
                video: "https://www.youtube.com/embed/kL_u4WkX980?controls=0",
                equipment: ["None"],
                setsReps: ["3 sets, hold for 30-60 seconds"],
                targetMuscles: ["Abs", "Obliques", "Lower Back"],
                instructions: [
                    "Start in a push-up position",
                    "Lower yourself onto your forearms",
                    "Keep your body in a straight line from head to heels",
                    "Engage your core and glutes",
                    "Hold the position without letting your hips sag"
                ]
            }
        ];

        let filteredExercises = [...EXERCISES];
        let activeCategories = [];
        let activeDifficulties = [];
        let searchTerm = "";

        const exercisesGrid = document.getElementById('exercises-grid');
        const searchInput = document.getElementById('search-input');
        const categoryFilters = document.getElementById('category-filters');
        const difficultyFilters = document.getElementById('difficulty-filters');
        const exerciseCountText = document.getElementById('exercise-count-text');
        
        const modal = document.getElementById('exercise-modal');
        const closeModalBtn = modal.querySelector('.close-button');
        const modalName = document.getElementById('modal-name');
        const modalTags = document.getElementById('modal-tags');
        const modalEquipment = document.getElementById('modal-equipment');
        const modalSetsReps = document.getElementById('modal-sets-reps');
        const modalDescription = document.getElementById('modal-description');
        const modalTargetMuscles = document.getElementById('modal-target-muscles');
        const modalInstructions = document.getElementById('modal-instructions');
        const modalVideoContainer = document.getElementById('modal-video-container');

        // Function to render a single exercise card
        function renderExerciseCard(exercise, index) {
            const card = document.createElement('div');
            card.className = 'exercise-card';
            // Use a data attribute to store the index for easy lookup later
            card.setAttribute('data-index', index); 
            card.innerHTML = `
                <div class="exercise-image-container">
                    <img src="${exercise.image}" alt="${exercise.name}" class="exercise-image">
                    <div class="overlay-tags">
                        <span class="tag bg-gray-900 text-white">${exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1)}</span>
                        <span class="tag ${exercise.category}-tag text-white">${exercise.category.charAt(0).toUpperCase() + exercise.category.slice(1)}</span>
                    </div>
                </div>
                <div class="p-4 flex-1 flex flex-col">
                    <h3 class="font-bold text-white text-lg mb-2">${exercise.name}</h3>
                    <p class="text-sm text-gray-400 flex-1">${exercise.description}</p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        ${exercise.tags.map(tag => `<span class="tag bg-gray-700 text-gray-200">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
            return card;
        }

        // Function to filter and render exercises
        function updateDisplay() {
            filteredExercises = EXERCISES.filter(exercise => {
                const matchesCategory = activeCategories.length === 0 || activeCategories.includes(exercise.category);
                const matchesDifficulty = activeDifficulties.length === 0 || activeDifficulties.includes(exercise.difficulty);
                const matchesSearch = searchTerm === "" ||
                                      exercise.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      exercise.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      exercise.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()));
                return matchesCategory && matchesDifficulty && matchesSearch;
            });

            exercisesGrid.innerHTML = '';
            if (filteredExercises.length > 0) {
                filteredExercises.forEach((exercise, index) => {
                    exercisesGrid.appendChild(renderExerciseCard(exercise, index));
                });
            } else {
                exercisesGrid.innerHTML = '<p class="text-center text-gray-500 col-span-full">No exercises found with the current filters.</p>';
            }

            exerciseCountText.textContent = filteredExercises.length;
            
            const counts = { pull: 0, push: 0, legs: 0, core: 0, cardio: 0 };
            EXERCISES.forEach(exercise => {
                if (
                    (activeDifficulties.length === 0 || activeDifficulties.includes(exercise.difficulty)) &&
                    (searchTerm === "" || exercise.name.toLowerCase().includes(searchTerm.toLowerCase()))
                ) {
                    if (counts.hasOwnProperty(exercise.category)) {
                        counts[exercise.category]++;
                    }
                }
            });

            document.getElementById('count-pull').textContent = counts.pull;
            document.getElementById('count-push').textContent = counts.push;
            document.getElementById('count-legs').textContent = counts.legs;
            document.getElementById('count-core').textContent = counts.core;
            document.getElementById('count-cardio').textContent = counts.cardio;
        }

        // Function to open the modal and populate it with exercise data
        function openModal(index) {
            const exercise = filteredExercises[index];
            if (!exercise) return;

            // Clear previous content
            modalTags.innerHTML = '';
            modalEquipment.innerHTML = '';
            modalSetsReps.innerHTML = '';
            modalTargetMuscles.innerHTML = '';
            modalInstructions.innerHTML = '';
            
            // Populate modal with content
            modalName.textContent = exercise.name;
            modalDescription.textContent = exercise.description;

            const categoryTag = document.createElement('span');
            categoryTag.className = `tag ${exercise.category}-tag text-white`;
            categoryTag.textContent = exercise.category.charAt(0).toUpperCase() + exercise.category.slice(1);
            modalTags.appendChild(categoryTag);

            const difficultyTag = document.createElement('span');
            difficultyTag.className = 'tag bg-gray-900 text-white';
            difficultyTag.textContent = exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1);
            modalTags.appendChild(difficultyTag);

            exercise.equipment.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                modalEquipment.appendChild(li);
            });

            exercise.setsReps.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                modalSetsReps.appendChild(li);
            });

            exercise.targetMuscles.forEach(muscle => {
                const span = document.createElement('span');
                span.className = 'tag bg-blue-100 text-blue-800';
                span.textContent = muscle;
                modalTargetMuscles.appendChild(span);
            });

            exercise.instructions.forEach(step => {
                const li = document.createElement('li');
                li.textContent = step;
                modalInstructions.appendChild(li);
            });

            // Set up video placeholder
            modalVideoContainer.innerHTML = `
                <iframe 
                    class="w-full h-full rounded-xl"
                    src="${exercise.video}" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            `;

            modal.classList.remove('hidden');
        }

        // Function to close the modal
        function closeModal() {
            modal.classList.add('hidden');
            // Stop video playback when the modal is closed
            const iframe = modalVideoContainer.querySelector('iframe');
            if (iframe) {
                // A common trick to stop an iframe video without removing the element
                const tempSrc = iframe.src;
                iframe.src = tempSrc;
            }
        }

        // Add event listeners for filters
        categoryFilters.addEventListener('click', (e) => {
            const tag = e.target.closest('.category-tag');
            if (tag) {
                const category = tag.dataset.category;
                tag.classList.toggle('active'); // Use toggle for active state
                if (activeCategories.includes(category)) {
                    activeCategories = activeCategories.filter(c => c !== category);
                } else {
                    activeCategories.push(category);
                }
                updateDisplay();
            }
        });

        difficultyFilters.addEventListener('click', (e) => {
            const tag = e.target.closest('.difficulty-tag');
            if (tag) {
                const difficulty = tag.dataset.difficulty;
                tag.classList.toggle('active'); // Use toggle for active state
                if (activeDifficulties.includes(difficulty)) {
                    activeDifficulties = activeDifficulties.filter(d => d !== difficulty);
                } else {
                    activeDifficulties.push(difficulty);
                }
                updateDisplay();
            }
        });

        // Add event listener for search input
        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            updateDisplay();
        });

        // Add event listener for clicking on any exercise card
        exercisesGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.exercise-card');
            if (card) {
                const index = card.getAttribute('data-index');
                openModal(index);
            }
        });

        // Add event listeners for the modal
        closeModalBtn.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Initial render
        updateDisplay();
    </script>
</body>
</html>
